{% extends "base.html" %}

{% block title %}{{ frontmatter.get('title', experiment.title if experiment else 'Research Experiment') }} - VALUES.md{% endblock %}

{% block head %}
<!-- Open Graph / Social Media Meta Tags -->
<meta property="og:type" content="article">
<meta property="og:title" content="{{ frontmatter.get('title', experiment.title if experiment else 'Research Experiment') }}">
<meta property="og:description" content="{{ frontmatter.get('abstract', experiment.summary if experiment else 'Research on LLM ethical decision-making') }}">
<meta property="og:url" content="{{ request.url }}">
<meta property="og:site_name" content="VALUES.md Research">

{% if frontmatter.get('date') %}
<meta property="article:published_time" content="{{ frontmatter.get('date') }}">
{% endif %}

{% if frontmatter.get('tags') %}
{% for tag in frontmatter.get('tags', []) %}
<meta property="article:tag" content="{{ tag }}">
{% endfor %}
{% endif %}

<!-- OG Image - use first figure if available -->
{% if experiment %}
{% set base_url = 'https://research.values.md' if 'localhost' not in request.url.netloc else (request.url.scheme + '://' + request.url.netloc) %}
<meta property="og:image" content="{{ base_url }}/static/research/{{ experiment.slug }}/output/figures/fig1_theory_action_gap.png">
<meta property="og:image:alt" content="Research findings visualization">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">
{% endif %}

<!-- Twitter Card -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="{{ frontmatter.get('title', experiment.title if experiment else 'Research Experiment') }}">
<meta name="twitter:description" content="{{ frontmatter.get('abstract', experiment.summary if experiment else 'Research on LLM ethical decision-making')[:200] }}">
{% if experiment %}
{% set base_url = 'https://research.values.md' if 'localhost' not in request.url.netloc else (request.url.scheme + '://' + request.url.netloc) %}
<meta name="twitter:image" content="{{ base_url }}/static/research/{{ experiment.slug }}/output/figures/fig1_theory_action_gap.png">
{% endif %}

<!-- Additional metadata -->
<meta name="description" content="{{ frontmatter.get('abstract', experiment.summary if experiment else 'Research on LLM ethical decision-making')[:160] }}">
<meta name="keywords" content="{{ ', '.join(frontmatter.get('tags', [])) }}">
{% endblock %}

{% block content %}
<a href="/research" class="back-link">‚Üê Back to Research</a>

{% if experiment %}
<div style="margin-bottom: 30px;">
    <h1>{{ experiment.title }}</h1>
    <div class="header-flex" style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;">
        <div>
            <span class="badge badge-domain">{{ experiment.date }}</span>
        </div>
        <div class="button-group" style="display: flex; gap: 10px;">
            <a href="/research/{{ experiment.slug }}/download"
               class="badge"
               style="background: #2c5282; color: white; text-decoration: none; padding: 10px 20px; font-size: 1em;">
                üì• Download Data Bundle
            </a>
            <a href="/research/guide"
               class="badge"
               style="background: #5a5a5a; color: white; text-decoration: none; padding: 10px 20px; font-size: 1em;">
                üìñ Reproducibility Guide
            </a>
        </div>
    </div>
</div>
{% endif %}

<!-- Findings Content -->
<div class="card">
    <div class="markdown-content">
        {{ findings_html|safe }}
    </div>
</div>

<style>
    /* Markdown content styling - Academic aesthetic */
    .markdown-content {
        line-height: 1.8;
    }

    .markdown-content h1 {
        font-size: 2em;
        margin-top: 0.5em;
        margin-bottom: 0.5em;
        border-bottom: 2px solid #d4d4d0;
        padding-bottom: 0.3em;
        color: #1a1a1a;
    }

    .markdown-content h2 {
        font-size: 1.5em;
        margin-top: 1.5em;
        margin-bottom: 0.5em;
        color: #1a1a1a;
    }

    .markdown-content h3 {
        font-size: 1.2em;
        margin-top: 1.2em;
        margin-bottom: 0.5em;
        color: #2a2a2a;
    }

    .markdown-content p {
        margin: 1em 0;
    }

    .markdown-content ul, .markdown-content ol {
        margin: 1em 0;
        padding-left: 2em;
    }

    .markdown-content li {
        margin: 0.5em 0;
    }

    .markdown-content code {
        background: #f5f5f3;
        padding: 2px 6px;
        border-radius: 2px;
        font-family: 'Monaco', 'Menlo', 'Consolas', monospace;
        font-size: 0.85em;
        color: #3a3a3a;
    }

    .markdown-content pre {
        background: #f5f5f3;
        padding: 20px;
        margin: 25px 0;
        border-radius: 2px;
        overflow-x: auto;
        border: 1px solid #e8e8e4;
    }

    .markdown-content pre code {
        background: none;
        padding: 0;
    }

    .markdown-content table {
        width: 100%;
        border-collapse: collapse;
        margin: 30px 0;
        font-size: 0.9em;
    }

    .markdown-content th, .markdown-content td {
        padding: 10px 12px;
        text-align: left;
        border-bottom: 1px solid #e0e0dc;
    }

    .markdown-content th {
        font-family: 'Inter', -apple-system, sans-serif;
        background: transparent;
        font-weight: 600;
        border-bottom: 2px solid #2a2a2a;
        color: #1a1a1a;
    }

    .markdown-content tr:last-child td {
        border-bottom: none;
    }

    .markdown-content tbody tr:nth-child(even) {
        background: #f5f5f3;
    }

    .markdown-content blockquote {
        margin: 30px 0;
        padding-left: 24px;
        border-left: 3px solid #c0c0b8;
        font-style: italic;
        color: #4a4a4a;
    }

    .markdown-content hr {
        border: none;
        border-top: 1px solid #d4d4d0;
        margin: 40px 0;
    }

    .markdown-content a {
        color: #2c5282;
        text-decoration: underline;
        text-decoration-color: rgba(44, 82, 130, 0.3);
        text-underline-offset: 2px;
    }

    .markdown-content a:hover {
        text-decoration-color: rgba(44, 82, 130, 0.8);
    }

    .markdown-content img {
        max-width: 100%;
        height: auto;
        border-radius: 4px;
        margin: 1em 0;
    }

    /* Mobile responsive tables */
    @media (max-width: 768px) {
        .markdown-content table {
            font-size: 0.9em;
        }

        .markdown-content th, .markdown-content td {
            padding: 8px;
        }
    }

    /* Mobile responsive layout for research detail page */
    @media (max-width: 768px) {
        /* Make header section stack vertically */
        .header-flex {
            flex-direction: column !important;
            align-items: flex-start !important;
            gap: 15px !important;
        }

        /* Stack buttons vertically and make them full width */
        .button-group {
            flex-direction: column !important;
            width: 100%;
            gap: 10px !important;
        }

        .button-group a {
            width: 100%;
            justify-content: center;
            padding: 12px 20px !important;
            font-size: 0.95em !important;
            display: flex !important;
        }

        /* Smaller badges on mobile */
        .badge-domain {
            font-size: 0.75em !important;
        }

        /* Better heading sizes on mobile */
        .markdown-content h1 {
            font-size: 1.6em;
        }

        .markdown-content h2 {
            font-size: 1.3em;
        }

        .markdown-content h3 {
            font-size: 1.1em;
        }
    }
</style>
{% endblock %}
